
R Under development (unstable) (2026-01-21 r89314) -- "Unsuffered Consequences"
Copyright (C) 2026 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> pkgname <- "free1way"
> source(file.path(R.home("share"), "R", "examples-header.R"))
> options(warn = 1)
> library('free1way')
> 
> base::assign(".oldSearch", base::search(), pos = 'CheckExEnv')
> base::assign(".old_wd", base::getwd(), pos = 'CheckExEnv')
> cleanEx()
> nameEx("free1way")
> ### * free1way
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: free1way
> ### Title: Distribution-free Inference in a Stratified One-Way Layout
> ### Aliases: free1way free1way.formula free1way.table free1way.numeric
> ###   free1way.factor print.free1way coef.free1way vcov.free1way
> ###   logLik.free1way summary.free1way confint.free1way
> ### Keywords: htest
> 
> ### ** Examples
> 
> 
> ## Kruskal-Wallis test
> kruskal.test(Ozone ~ Month, data = airquality)

	Kruskal-Wallis rank sum test

data:  Ozone by Month
Kruskal-Wallis chi-squared = 29.267, df = 4, p-value = 6.901e-06

> kt <- free1way(Ozone ~ Month, data = airquality)
> print(kt)

	5-sample Kruskal-Wallis test against proportional odds alternatives

data:  Ozone by Month (5, 6, 7, 8, 9)
Perm chi-squared = 29.267, df = 4, p-value = 6.901e-06
alternative hypothesis: true log-odds ratio is not equal to 0

> # log-odds ratios for comparison with control
> coef(kt)
   Month6    Month7    Month8    Month9 
0.8123639 2.5281594 2.3825979 0.7513235 
> # Wald inference
> summary(kt)

Call:
free1way.formula(formula = Ozone ~ Month, data = airquality)

Coefficients:
       log-odds ratio Std. Error z value P(>|z|)
Month6        0.81236    0.64415 1.26113  0.2073
Month7        2.52816    0.53153 4.75639  0.0000
Month8        2.38260    0.53370 4.46432  0.0000
Month9        0.75132    0.47177 1.59256  0.1113
> confint(kt, test = "Wald")
            2.5 %   97.5 %
Month6 -0.4501567 2.074884
Month7  1.4863809 3.569938
Month8  1.3365705 3.428625
Month9 -0.1733322 1.675979
> 
> ## Friedman test
> example(friedman.test, echo = FALSE)
> me <- colnames(RoundingTimes)
> d <- expand.grid(me = factor(me, labels = me, levels = me),
+                  id = factor(seq_len(nrow(RoundingTimes))))
> d$time <- c(t(RoundingTimes))
> # global p-value identical
> friedman.test(RoundingTimes)

	Friedman rank sum test

data:  RoundingTimes
Friedman chi-squared = 11.143, df = 2, p-value = 0.003805

> ft <- free1way(time ~ me | id, data = d)
> print(ft)

	Stratified 3-sample Kruskal-Wallis test against proportional odds
	alternatives

data:  time by me (Round Out, Narrow Angle, Wide Angle) 
	 stratified by id
Perm chi-squared = 11.143, df = 2, p-value = 0.003805
alternative hypothesis: true log-odds ratio is not equal to 0

> coef(ft)
meNarrow Angle   meWide Angle 
     -1.265280      -3.289198 
> # Wald inference
> summary(ft)

Call:
free1way.formula(formula = time ~ me | id, data = d)

Coefficients:
               log-odds ratio Std. Error  z value P(>|z|)
meNarrow Angle       -1.26528    0.68264 -1.85352  0.0638
meWide Angle         -3.28920    0.79367 -4.14428  0.0000
> confint(ft, test = "Wald")
                   2.5 %      97.5 %
meNarrow Angle -2.603222  0.07266103
meWide Angle   -4.844765 -1.73363038
> 
> ## McNemar test
> ## paired binary observations
> example(mcnemar.test, echo = FALSE)
> # set-up data frame with survey outcomes for voters
> s <- gl(2, 1, labels = dimnames(Performance)[[1L]])
> survey <- gl(2, 1, labels = c("1st", "2nd"))
> nvoters <- c(Performance)
> x <- expand.grid(survey = survey, voter = factor(seq_len(sum(nvoters))))
> x$performance <- c(rep(s[c(1, 1)], nvoters[1]), rep(s[c(2, 1)], nvoters[2]),
+                    rep(s[c(1, 2)], nvoters[3]), rep(s[c(2, 2)], nvoters[4]))
> # note that only those voters changing their minds are relevant
> mcn <- free1way(xtabs(~ performance + survey + voter, data = x))
> # same result as mcnemar.test w/o continuity correction
> print(mcn)

	Stratified 2-sample Wilcoxon test against proportional odds
	alternatives

data:  performance by survey (c("1st", "2nd")) 
	 stratified by voter
Perm Z = 4.166, p-value = 3.099e-05
alternative hypothesis: true log-odds ratio is not equal to 0

> # X^2 statistic
> summary(mcn, test = "Permutation")$statistic^2
  Perm Z 
17.35593 
> mcnemar.test(Performance, correct = FALSE)

	McNemar's Chi-squared test

data:  Performance
McNemar's chi-squared = 17.356, df = 1, p-value = 3.099e-05

> # Wald inference
> summary(mcn)

Call:
free1way.table(y = xtabs(~performance + survey + voter, data = x))

Coefficients:
          log-odds ratio Std. Error z value P(>|z|)
survey2nd        1.11258    0.19128 5.81639       0
> confint(mcn, test = "Wald")
              2.5 %   97.5 %
survey2nd 0.7376684 1.487484
> 
> ## Mantel-Haenszel test w/o continuity correction, 
> ## Departments are blocks
> mantelhaen.test(UCBAdmissions, correct = FALSE)

	Mantel-Haenszel chi-squared test without continuity correction

data:  UCBAdmissions
Mantel-Haenszel X-squared = 1.5246, df = 1, p-value = 0.2169
alternative hypothesis: true common odds ratio is not equal to 1
95 percent confidence interval:
 0.7719074 1.0603298
sample estimates:
common odds ratio 
        0.9046968 

> mh <- free1way(UCBAdmissions)
> print(mh)

	Stratified 2-sample Wilcoxon test against proportional odds
	alternatives

data:  Admit by Gender (c("Male", "Female")) 
	 stratified by Dept
Perm Z = -1.2347, p-value = 0.2169
alternative hypothesis: true log-odds ratio is not equal to 0

> # common odds-ratio, with score interval
> exp(coef(mh))
GenderFemale 
    0.904955 
> exp(confint(mh, test = "Rao"))
                 2.5 %  97.5 %
GenderFemale 0.7723922 1.06027
> # looking at department-specific 
> # confidence intervals for log-odds ratios 
> # it seems Dept A is out of line
> apply(UCBAdmissions, MARGIN = 3,  
+       FUN = function(x) confint(free1way(as.table(x))))
      Dept
                A          B          C          D          E          F
  [1,] -1.5622307 -1.0556769 -0.1570020 -0.3762303 -0.1913598 -0.7802366
  [2,] -0.5415513  0.6167797  0.4068713  0.2122505  0.5918809  0.4025005
> 
> ## Mantel-Haenszel test treats variables as
> ## unordered, free1way allows ordered responses
> example(mantelhaen.test, echo = FALSE)
> # Does distribution of job satisfaction (ordered) depend on income
> # in a stratified proportional odds model?
> # Job Satisfaction is second in array but needs to be first
> # for free1way to treat it as ordered response
> ft <- free1way(aperm(Satisfaction, perm = c(2, 1, 3)))
> summary(ft)

Call:
free1way.table(y = aperm(Satisfaction, perm = c(2, 1, 3)))

Coefficients:
                  log-odds ratio Std. Error z value P(>|z|)
Income5000-15000         0.10794    0.55953 0.19290  0.8470
Income15000-25000        1.45998    0.62561 2.33369  0.0196
Income>25000             1.23282    0.65693 1.87663  0.0606
> 
> 
> 
> 
> cleanEx()
> nameEx("power.free1way.test")
> ### * power.free1way.test
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: power.free1way.test
> ### Title: Power Calculations in Distribution-free Stratified One-Way
> ###   Layouts
> ### Aliases: rfree1way power.free1way.test
> ### Keywords: htest
> 
> ### ** Examples
> 
> 
> ## make example reproducible
> if (!exists(".Random.seed", envir = .GlobalEnv, inherits = FALSE)) 
+     runif(1)
> R.seed <- get(".Random.seed", envir = .GlobalEnv)
> set.seed(29)
> 
> ## sample from proportional odds model with 1:2 allocation
> ## based on odds ratio of 3, with sample sizes (15, 30)
> x <- rfree1way(n = 15, delta = log(3), alloc_ratio = 2)
> 
> # Wilcoxon-Mann-Whitney rank sum test via classical stats interface
> wilcox.test(y ~ groups, data = x, exact = FALSE, correct = FALSE)$p.value
[1] 0.008679882
> 
> # Identical p-value obtained from a proportional-odds model 
> summary(free1way(y ~ groups, data = x), test = "Permutation")$p.value
     Perm Z 
0.008679882 
> 
> # approximate power for this test
> power.free1way.test(n = 15, delta = log(3), alloc_ratio = 2)

      2-sample Wilcoxon test against proportional odds alternatives 

                n = 15
Total sample size = 15 (Control) + 30 (B) = 45
            power = 0.4879209
        sig.level = 0.05
   Standard error = 0.5693603
   log-odds ratio = 1.098612

NOTE: 'n' is sample size in control group

> 
> assign(".Random.seed", R.seed, envir = .GlobalEnv)
> 
> 
> 
> cleanEx()
> nameEx("ppplot")
> ### * ppplot
> 
> flush(stderr()); flush(stdout())
> 
> ### Name: ppplot
> ### Title: Probability-probability Plots
> ### Aliases: ppplot
> ### Keywords: hplot distribution
> 
> ### ** Examples
> 
> 
> ## make example reproducible
> if (!exists(".Random.seed", envir = .GlobalEnv, inherits = FALSE)) 
+     runif(1)
> R.seed <- get(".Random.seed", envir = .GlobalEnv)
> set.seed(29)
> 
> ## well-fitting logistic model
> nd <- data.frame(groups = gl(2, 50, labels = paste0("G", 1:2)))
> nd$y <- rlogis(nrow(nd), location = c(0, 2)[nd$groups])
> with(with(nd, split(y, groups)),
+      ppplot(G1, G2, conf.level = .95,
+             conf.args = list(link = "logit", type = "Wald", col = 2)))
> # with appropriate Wilcoxon test and log-odds ratio
> coef(ft <- free1way(y ~ groups, data = nd))
groupsG2 
1.668854 
> # the model-based probability-probability curve
> prb <- 1:99 / 100
> points(prb,  plogis(qlogis(prb) - coef(ft)), pch = 3)
> 
> ## the corresponding model-based receiver operating characteristic (ROC)
> ## curve, see Sewak and Hothorn (2023)
> plot(prb,  plogis(qlogis(1 - prb) - coef(ft), lower.tail = FALSE),
+      xlab = "1 - Specificity", ylab = "Sensitivity", type = "l", 
+      main = "ROC Curve")
> abline(a = 0, b = 1, col = "lightgrey")
> # with confidence band
> lines(prb, plogis(qlogis(1 - prb) - confint(ft, test = "Rao")[1], 
+       lower.tail = FALSE), lty = 3)
> lines(prb, plogis(qlogis(1 - prb) - confint(ft, test = "Rao")[2], 
+       lower.tail = FALSE), lty = 3)
> # and corresponding area under the ROC curve (AUC)
> # with score confidence interval
> coef(ft, what = "AUC")
groupsG2 
 0.75467 
> confint(ft, test = "Rao", what = "AUC")
             2.5 %    97.5 %
groupsG2 0.6490714 0.8381977
> 
> ## ill-fitting normal model
> nd$y <- rnorm(nrow(nd), mean = c(0, .5)[nd$groups], sd = c(1, 1.5)[nd$groups])
> with(with(nd, split(y, groups)),
+      ppplot(G1, G2, conf.level = .95,
+             conf.args = list(link = "probit", type = "Wald", col = 2)))
> # inappropriate probit model
> coef(free1way(y ~ groups, data = nd, link = "probit"))
 groupsG2 
0.6659502 
> 
> assign(".Random.seed", R.seed, envir = .GlobalEnv)
> 
> 
> 
> ### * <FOOTER>
> ###
> cleanEx()
> options(digits = 7L)
> base::cat("Time elapsed: ", proc.time() - base::get("ptime", pos = 'CheckExEnv'),"\n")
Time elapsed:  2.346 0.06 2.406 0 0 
> grDevices::dev.off()
null device 
          1 
> ###
> ### Local variables: ***
> ### mode: outline-minor ***
> ### outline-regexp: "\\(> \\)?### [*]+" ***
> ### End: ***
> quit('no')
