
R version 4.1.1 (2021-08-10) -- "Kick Things"
Copyright (C) 2021 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> 
> library("smirnov")

Attaching package: 'smirnov'

The following object is masked from 'package:stats':

    ks.test

> set.seed(290875)
> 
> ### 2-sample two-sided KS distribution from stats, with w/o ties only
> pks2 <- function(q, n.x, n.y, exact = TRUE, tol = 1e-06) {
+     if (any(q < 0)) return(0)
+     if (any(q > 1)) return(1)
+     if (is.numeric(q)) 
+         q <- as.double(q)
+     else stop("argument 'q' must be numeric")
+     p <- rep(0, length(q))
+     p[is.na(q)] <- NA
+     IND <- which(!is.na(q))
+     if (!length(IND)) return(p)
+     if (n.x < 1) stop("not enough 'x' data")
+     if (n.y < 1) stop("not enough 'y' data")
+     if (exact) {
+         p[IND] <- sapply(q[IND], function(s) 
+                          .Call(stats:::C_pSmirnov2x, s, floor(n.x), floor(n.y)))
+     } else {
+         n <- n.x * n.y/(n.x + n.y)
+         p[IND] <- .Call(stats:::C_pKS2, p = sqrt(n) * x[IND], tol)
+     }
+     return(p)
+ }
> 
> all.equal(psmirnov(1:999/1000, 10, 20), pks2(1:999/1000, 10, 20))
[1] TRUE
> 
> ### examples by Schröer & Trenkler (1995) without ties
> all.equal(psmirnov(3 / 7, 7, 5), pks2(3 / 7, 7, 5))
[1] TRUE
> 
> all.equal(psmirnov(n.x = 3, n.y = 4, q = 1/2, lower.tail = FALSE),
+           1 - pks2(n.x = 3, n.y = 4, q = 1/2))
[1] TRUE
> psmirnov(n.x = 3, n.y = 4, q = 1/6, lower.tail = FALSE, two.sided = FALSE)
[1] 0.8
> psmirnov(n.x = 4, n.y = 3, q = 1/2, lower.tail = FALSE, two.sided = FALSE)
[1] 0.3428571
> 
> all.equal(psmirnov(n.x = 5, n.y = 7, q = 3 / 7, lower.tail = FALSE),
+           1 - pks2(n.x = 5, n.y = 7, q = 3 / 7))
[1] TRUE
> 
> all.equal(psmirnov(n.x = 300, n.y = 520, q = 1/8, lower.tail = FALSE),
+           1 - pks2(n.x = 300, n.y = 520, q = 1/8))
[1] TRUE
> psmirnov(obs = round(rnorm(820)), n.x = 300, n.y = 520, 
+          q = 1/8, lower.tail = FALSE)
[1] 0.00038641
> 
> library("coin")
Loading required package: survival
> ### tied example by Schröer & Trenkler (1995); use coin to 
> ### approximate conditional p-value
> gr <- rep(gl(2, 1), c(5, 7))
> x <- c(1, 2, 2, 3, 3, 1, 2, 3, 3, 4, 5, 6)
> mt <- maxstat_test(gr ~ x, minprob = 0, maxprob = 1)
> pls <- coin:::MonteCarlo(x = mt@statistic@xtrans, y = mt@statistic@ytrans, 
+                          weights = mt@statistic@weights, 
+                          block = mt@statistic@block, nresample = 1e7,
+                          parallel = "no")
> TS <- colSums(mt@statistic@xtrans)
> N <- table(gr)
> KS <- abs(TS / N[2] - pls * sum(N) / prod(N))
> mKS <- apply(KS, 2, max)
> mean(mKS >= 3 / 7 - sqrt(.Machine$double.eps))
[1] 0.2424465
> psmirnov(obs = x, n.x = 5, q = 3 / 7, lower.tail = FALSE)
[1] 0.2424242
> 
> ### check quantiles
> ### Kim & Jennrich (1973) in Selected Tables in Mathematical Statistics, Vol 1
> ### (ed. Harter) Institute of Mathematical Statistics, page 129
> all.equal(qsmirnov(1 - .05, 8, 6) * 8 * 6, 34)
[1] TRUE
> all.equal(qsmirnov(1 - .01, 8, 6) * 8 * 6, 40)
[1] TRUE
> all.equal(qsmirnov(1 - .001, 8, 6) * 8 * 6, 48)
[1] TRUE
> all.equal(qsmirnov(1 - .05, 14, 10) * 140, 74)
[1] TRUE
> all.equal(qsmirnov(1 - .01, 14, 10) * 140, 90)
[1] TRUE
> all.equal(qsmirnov(1 - .001, 14, 10) * 140, 106)
[1] TRUE
> 
> ### without ties
> q <- qsmirnov(1:9/10, 5, 7)
> p <- psmirnov(q, 5, 7)
> all.equal(qsmirnov(p, 5, 7), q)
[1] TRUE
> 
> ### with ties
> obs <- c(1, 2, 2, 3, 3, 1, 2, 3, 3, 4, 5, 6)
> q <- qsmirnov(1:9/10, 5, 7, obs = obs)
> p <- psmirnov(q, 5, 7, obs = obs)
> all.equal(qsmirnov(p, 5, 7, obs = obs), q)
[1] TRUE
> 
> 
> ### without ties
> q <- qsmirnov(1:9/10, 5, 7, two.sided = FALSE)
> p <- psmirnov(q, 5, 7, two.sided = FALSE)
> all.equal(qsmirnov(p, 5, 7, two.sided = FALSE), q)
[1] TRUE
> 
> ### with ties
> obs <- c(1, 2, 2, 3, 3, 1, 2, 3, 3, 4, 5, 6)
> q <- qsmirnov(1:9/10, 5, 7, obs = obs, two.sided = FALSE)
> p <- psmirnov(q, 5, 7, obs = obs, two.sided = FALSE)
> all.equal(qsmirnov(p, 5, 7, obs = obs, two.sided = FALSE), q)
[1] TRUE
> 
> 
> proc.time()
   user  system elapsed 
 28.867   0.911  29.771 
